%% Preamble %%
%% A minimal LaTeX preamble
%% Some packates are needed to implement
%% Asciidoc features

\documentclass[11pt]{amsart}
\usepackage{geometry}                % See geometry.pdf to learn the layout options. There are lots.
\geometry{letterpaper}               % ... or a4paper or a5paper or ...
%\geometry{landscape}                % Activate for for rotated page geometry
%\usepackage[parfill]{parskip}       % Activate to begin paragraphs with an empty line rather than an indent

\usepackage{tcolorbox}
\usepackage{lipsum}

\usepackage{epstopdf}
\usepackage{color}
% \usepackage[usenames, dvipsnames]{color}
% \usepackage{alltt}


\usepackage{amssymb}
% \usepackage{amsmath}
\usepackage{amsthm}
\usepackage[version=3]{mhchem}


% Needed to properly typeset
% standard unicode characters:
%
\RequirePackage{fix-cm}
\usepackage{fontspec}
\usepackage[Latin,Greek]{ucharclasses}
%
% NOTE: you must also use xelatex
% as the typesetting engine


% \usepackage{fontspec}
% \usepackage{polyglossia}
% \setmainlanguage{en}

\usepackage{hyperref}
\hypersetup{
    colorlinks=true,
    linkcolor=blue,
    filecolor=magenta,
    urlcolor=cyan,
}

\usepackage{graphicx}
\usepackage{wrapfig}
\graphicspath{ {images/} }
\DeclareGraphicsExtensions{.png, .jpg, jpeg, .pdf}

%% \DeclareGraphicsRule{.tif}{png}{.png}{`convert #1 `dirname #1`/`basename #1 .tif`.png}
%% Asciidoc TeX Macros %%


% \pagecolor{black}
%%%%%%%%%%%%


% Needed for Asciidoc

\newcommand{\admonition}[2]{\textbf{#1}: {#2}}
\newcommand{\rolered}[1]{ \textcolor{red}{#1} }
\newcommand{\roleblue}[1]{ \textcolor{blue}{#1} }

\newtheorem{theorem}{Theorem}
\newtheorem{proposition}{Proposition}
\newtheorem{corollary}{Corollary}
\newtheorem{lemma}{Lemma}
\newtheorem{definition}{Definition}
\newtheorem{conjecture}{Conjecture}
\newtheorem{problem}{Problem}
\newtheorem{exercise}{Exercise}
\newtheorem{example}{Example}
\newtheorem{note}{Note}
\newtheorem{joke}{Joke}
\newtheorem{objection}{Objection}





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%  Extended quote environment with author

\renewenvironment{quotation}
{   \leftskip 4em \begin{em} }
{\end{em}\par }

\def\signed#1{{\leavevmode\unskip\nobreak\hfil\penalty50\hskip2em
  \hbox{}\nobreak\hfil\raise-3pt\hbox{(#1)}%
  \parfillskip=0pt \finalhyphendemerits=0 \endgraf}}


\newsavebox\mybox

\newenvironment{aquote}[1]
  {\savebox\mybox{#1}\begin{quotation}}
  {\signed{\usebox\mybox}\end{quotation}}

\newenvironment{tquote}[1]
  {  {\bf #1} \begin{quotation} \\ }
  { \end{quotation} }

%% BOXES: http://tex.stackexchange.com/questions/83930/what-are-the-different-kinds-of-boxes-in-latex
%% ENVIRONMENTS: https://www.sharelatex.com/learn/Environments

\newenvironment{asciidocbox}
  {\leftskip6em\rightskip6em\par}
  {\par}

\newenvironment{titledasciidocbox}[1]
  {\leftskip6em\rightskip6em\par{\bf #1}\vskip-0.6em\par}
  {\par}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% http://texblog.org/tag/rightskip/


\newenvironment{preamble}
  {}
  {}

%% http://tex.stackexchange.com/questions/99809/box-or-sidebar-for-additional-text
%%
\newenvironment{sidebar}[1][r]
  {\wrapfigure{#1}{0.5\textwidth}\tcolorbox}
  {\endtcolorbox\endwrapfigure}


%%%%%%%%%%

\newenvironment{comment*}
  {\leftskip6em\rightskip6em\par}
  {\par}

  \newenvironment{remark*}
  {\leftskip6em\rightskip6em\par}
  {\par}


%% Dummy environment for testing:

\newenvironment{foo}
  {\bf Foo.\ }
  {}


\newenvironment{foo*}
  {\bf Foo.\ }
  {}


\newenvironment{click}
  {\bf Click.\ }
  {}

\newenvironment{click*}
  {\bf Click.\ }
  {}


\newenvironment{remark}
  {\bf Remark.\ }
  {}

\newenvironment{capsule}
  {\leftskip10em\par}
  {\par}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% Style

\parindent0pt
\parskip8pt
%% User Macros %%
%% Front Matter %%

\title{The Modeliing HiFiMagnet Guide}
\author{Mayaffre Gabriel}
\date{2017-04-04}


%% Begin Document %%

\begin{document}
\maketitle
\tableofcontents
\hypertarget{x-\textbf{notations}}{\section{\textbf{Notations}}}
\hypertarget{x-constants-and-variable}{\subsection{Constants and variable}}
\begin{center}
\begin{tabular}{|c|c|c|}
\hline
$\rho$ & material’s density & $kg.m^{-3}$ \\ 
C${}_{p}$ & thermal capacity & $J.K^{-1}$ \\ 
r & radius & m \\ 
T & temperature & K \\ 
k & thermal conductivity & $W.m^{-1} .K^{-1}$ \\ 
U & electrical potential & V \\ 
$\sigma$ & electrical conductivity & $S.m^{-1}$ \\ 
h & heat transfer coefficient & $W.m^{-2} .K^{-1}$ \\ 
\textbf{A} & magnetic potential & $V.s.m^{-1}$ \\ 
\textbf{B} & magnetic induction & T \\ 
\textbf{H} & magnetic field & $A.m^{-1}$ \\ 
\hline
\end{tabular}
\end{center}

\hypertarget{x-conventions}{\subsection{Conventions}}
\begin{description}

\item[$f$]function

\item[$\textbf{f}$]vector of functions

\end{description}


\hypertarget{x-functions}{\subsection{Functions}}
\begin{description}

\item[$\nabla f$]gradient of f

\item[$\nabla.\textbf{ f }$]divergence of \textbf{f}

\item[$\nabla \times \textbf{ f }$]curl of \textbf{f}

\item[$L_{2}(\Omega)$]$\{f  \mid \int f^{2} < \infty\}$  Lagrangian

\item[$H_{1}(\Omega)$]$\{f \in L_{2}(\Omega) \mid \nabla f \in [L_{2}(\Omega)^{d}\}$]  Hilbert space

\item[$H_{div}(\Omega)$]$\{\textbf{f}\in [L^{2} (\Omega\cup\Omega_{c})^{d}| \nabla.\textbf{f}\in L^{2}(\Omega\cup\Omega_{c})\}$] Divergence space

\item[$H_{curl}(\Omega)$]$\{\textbf{f}\in [L^{2} (\Omega\cup\Omega_{c})^{d}| \nabla\times\textbf{f}\in [L^{2} (\Omega\cup\Omega_{c})]^{d}\}$] Rotational space

\end{description}


\hypertarget{x-\textbf{modelisation}}{\section{\textbf{Modelisation}}}
The study of a magnet is a multi-physic problem. It combine electromagnetism, thermic and mechanics.
We divide the modeling into 4 parts:


\begin{enumerate}

\item{\textbf{Thermo-electric} \\
The current flow inside the magnet (copper) involves a warming of the material, due to Joule effect.
The temperature in the different sections of the magnet are calculated thanks to the heat equation (more details below).}

\item{\textbf{Elasticity} \\
The temperature’s elevation involves a dilatation of the material. It implies some constraints due to the nature of the material.}

\item{\textbf{Hydraulics} \\
Due to the strong current flow inside the magnet, the temperature will rise dangerously.
We need to cool down the magnet, with fluid which will circulate around the material.
This involves the Colburn correlation with the properties of the fluid.}

\item{\textbf{Electromagnetism} \\
The purpose of a magnet is to create a magnetic field, consequently, we will use the Maxwell’s equations.}

\end{enumerate}


\hypertarget{x-thermo-electric}{\subsection{Thermo-electric}}
\hypertarget{x-equations}{\subsubsection{Equations}}
First of all, we start with the standart heat equation:



\[
\rho C_{p}\frac{\partial T}{\partial t} - \nabla.(k \nabla T)=P
\]



The only source of heat considered is the Joule effect, translated by :



\[
P=\textbf{j.E}
\]



Where $\textbf{j}=\sigma\textbf{E}$  (from the Ohm’s law).
But $\exists V | \textbf{E}=-\nabla V$


\admonition{NOTE}{To see more details, \href{http://book.feelpp.org/toolbox/thermoelectric}{Thermo-Electric Toolbox}}
We also consider that T is time independent, so, finally, we have :



\[
- \nabla.(k \nabla T)=\sigma\nabla V . \nabla V
\]



Coefficients $\sigma$ and k are temperature-dependent as shown in this equations :


\begin{itemize}

\item $\sigma=\frac{\sigma_ {0}}{1 + \alpha(T-T_{ref})}$

\item $k=k_{0}\frac{T}{(1+\alpha(T-T_{ref}))T_{ref}}$

\end{itemize}


\hypertarget{x-finite-element}{\subsubsection{Finite Element}}
\hypertarget{x-fem}{\paragraph{FEM}}
The Finite Element Method is detailed in the chapter \href{http://book.feelpp.org/math/fem#cha:appr-r-probl-1}{The Mathematics of Feel++}


Finally, in our case, the variationnal formulation then consists in finding $V\in X_{T}=H_{1}(\Omega)   \forall \phi_{T}\in X_{T}$  :



\[
\int_{\Omega}k(T)\nabla\phi_{T} + \int_{\partial\Omega_{cooled}}hT\phi_{T}=\int_{\Omega}\sigma(T)\nabla V. \nabla V +\int_{\partial\Omega_{cooled}}hT_{\omega}\phi_{T}
\]



We use the Picard method to solve this non linear variationnal formulation.


\hypertarget{x-picard-method}{\paragraph{Picard method}}
The Picard method is an iterative method which approach the solution of a differential equation, until the difference between y${}_{n+1}$ and y${}_{n}$ becomes lower than an user-defined tolerance.


\begin{itemize}

\item $\frac{dy}{dx}=f(x,y)$ with $y(x_{0})=y_{0}$

\item $y_{n}=y_{0}+\int_{x_{0}}^{x}f(s,y_{n-1}(s))ds$

\end{itemize}


\hypertarget{x-boundary-conditions}{\subsubsection{Boundary conditions}}
The current is due to a difference of potential. We model this with the Dirichlet conditions :


\begin{itemize}

\item V=0 on V${}_{in}$

\item V=V${}_{0}$ on V${}_{out}$

\end{itemize}


We consider that the air and the cooling water around the material are electrically insulating. We model that with the Neumann conditions which set the current density flux to null :


$-\sigma(T)\nabla V.n=0$ for all surfaces except V${}_{in}$ and V${}_{out}$


On the surfaces cooled, we set the heat transfer coefficient \emph{h}, determined as follow :


$h=\frac{k(T)N_{u}}{D_{h}}$ with N${}_{u}$ the Nusselt number and D${}_{h}$ the hydraulic diameter.


\admonition{NOTE}{To see some examples (with the code behind), see the chapter \href{/examples}{Examples}}
\hypertarget{x-magnetostatic}{\subsection{Magnetostatic}}
\hypertarget{x-equations}{\subsubsection{Equations}}
First of all, we start with two of the four Maxwell’s equations :



\[
    \left\{ \begin{array}{cc}
      \nabla\times\textbf{H}=\textbf{j}\\
      \nabla.\textbf{B}=0 \end{array} \right.
\]



We also can link the magnetic induction (\textbf{B}) and the magnetic field (\textbf{H}) using the permeability ($\mu$) as :



\[
\textbf{B}=\mu\textbf{H}
\]



with $\mu=\mu_{r}\mu_{0}$


\begin{itemize}

\item $\mu_{r}$ being the permeability specific to the material

\item $\mu_{0}$ being the vacuum permeability

\end{itemize}


From the differential operators, we know that \textbf{rot}.\textbf{div}.\textbf{A} = 0    $\forall$ \textbf{A}.


Thus, since $\nabla.\textbf{B}=0$ there exists \textbf{A} such as $\textbf{B}=\nabla\times \textbf{A}$


Finally, we can write :



\[
\nabla\times\left(\frac{1}{\mu}\nabla\times\textbf{A}\right)=\textbf{j}
\]



\hypertarget{x-finite-element}{\subsubsection{Finite Element}}
The Finite Element Method is detailed in the chapter \href{http://book.feelpp.org/math/fem#cha:appr-r-probl-1}{The Mathematics of Feel++}


In our case, the variational formulation consists in resolve :



\[
\int_{\Omega\cup\Omega_{c}}\nabla\times\frac{1}{\mu}\nabla\times\textbf{A}\varphi=\int_{\Omega}\textbf{j}\varphi
\]



with $\Omega$ being the volume of our geometry and $\Omega_{c}$ the volume inside (for example the air).


By integration by parts, we now consider this equation :



\[
\int_{\Omega\cup\Omega_{c}}\frac{1}{\mu}\textbf{A}.\nabla\times\varphi+\int_{\partial\Omega_{c}}\frac{1}{\mu}\left(\nabla\times\textbf{A}\times\textbf{n}\right).\varphi=\int_{\Omega}\textbf{j}.\varphi
\]



$\textbf{A}\in\{\textbf{v}\in L^{2}(\Omega\cup\Omega_{c}); \nabla\times\textbf{v}\in L^{2}(\Omega\cup\Omega_{c})\}$
corresponding of H${}_{curl}$ .


\hypertarget{x-boundary-conditions}{\subsubsection{Boundary conditions}}
The current density is located in some finite region in space, this involves considering \textbf{B} as zero at infinity.
But, with the Finite Element Method,we discretize the domain so we impose the domain to be of finite dimension.
In fact, this domain is composed by $\Omega$ (the conductor) and a box inside, $\Omega_{c}$, whose boundaries model the infinity.
The size of this box can be set manually or be calculated for more precision and validity.
The boundary condition is expressed with the magnetic potential (\textbf{A}) like this :



\[
\textbf{A}\times\textbf{n}=0\, on\, \partial\Omega_{c}
\]



Our materials allow us to only consider the vacuum permeability, so $\mu=\mu_{0}=4\pi.10^{-7} kg.m.A^{-2} .s^{-2}$.


\admonition{NOTE}{To see some examples (with the code behind), see the chapter \href{/examples}{Examples}}
\hypertarget{x-linear-elasticity}{\subsection{Linear elasticity}}
The objective is to calculate the displacement vector \textbf{u} generated by the dilatation due to the temperature elevation.


\hypertarget{x-conditions-and-suppositions}{\subsubsection{Conditions and suppositions}}
We need some preconditions :


\begin{itemize}

\item The moments chosen are considered to be equilibrium

\item The only forces considered are the Lorentz force and the thermal expansion.

\end{itemize}


\hypertarget{x-equations}{\subsubsection{Equations}}
First, we start with the equation of motion, becoming the equilibrium equation :



\[
div(\bar{\bar{\sigma}})+\textbf{f}=0
\]



With $\bar{\bar{\sigma}}$ the stress tensor and \textbf{f} the volume forces applied on the conductor.
As we search the displacement vector \textbf{u}, we introduce the tehsor of small deformation $\bar{\bar{\epsilon}}$



\[
\bar{\bar{\epsilon}}=\frac{1}{2}(\nabla\textbf{u}+\nabla\textbf{u}^{T})
\]



We divide the stress tensor in two terms : $\bar{\bar{\sigma}}^{E}$ given by the Hooke’s law for the small deformation
and $\bar{\bar{\sigma}}^{T}$ bring by the Joule eating.



\[
\bar{\bar{\sigma}}(\bar{\bar{\epsilon}})=\bar{\bar{\sigma}}^{E} (\bar{\bar{\epsilon}})+\bar{\bar{\sigma}}^{T}(\bar{\bar{\epsilon}})
\]



This terms are define so :


\begin{itemize}

\item $\bar{\bar{\sigma}}^{E}(\bar{\bar{\epsilon}})=\frac{E}{1+\nu}(\bar{\bar{\epsilon}}+\frac{\nu}{1+2\nu}Tr(\bar{\bar{\epsilon}})\bar{\bar{I}})$

\item $\bar{\bar{\sigma}}^{T}(\bar{\bar{\epsilon}})=-\frac{E}{1+\nu}\alpha_{T}(T-T_{0})\bar{\bar{I}}$

\end{itemize}


With :


\begin{itemize}

\item $E$ the Young modulus

\item $\nu$ the Poisson’s ratio

\item $\bar{\bar{I}}$ the identity tensor

\item $\alpha_{T}$ the linear dilatation coefficient

\item $T and T_{0}$ the temperature at time $t and t_{0}$

\end{itemize}


\hypertarget{x-finite-element}{\subsubsection{Finite Element}}
The Finite Element Methid is detailed in the chapter \href{http://book.feelpp.org/math/fem#cha:appr-r-probl-1}{The Mathematics of Fell++}


In our case, the variational formulation consists in resolve :



\[
-\int_{\Omega}(\nabla.\bar{\bar{\sigma}})\circ\varphi=\int_{\Omega}\textbf{f}\circ\varphi
\]



With $\circ$ the element-wise product.


Finally, considering this with the equations, we finally have :



\[
\frac{E}{1+\nu}\int_{\Omega}Tr\lgroup\frac{1}{2}(\nabla\textbf{u}+\nabla\textbf{u}^{T})\rgroup+\frac{E\nu}{(1+\nu)(1-2\nu)}\int_{\Omega}(\nabla.\textbf{u})(\nabla.\varphi)=\int_{\Omega}\textbf{f}.\varphi+\int_{\partial\Omega_{P}}\textbf{g}.\varphi+\int_{\Omega}\frac{E\alpha_{T}}{1-2\nu}(T-T_{0})(\nabla.\varphi)
\]


for all $\varphi\in H_{1,\varphi}^{d}(\Omega)$


\admonition{NOTE}{To see some examples (with the code behind), see the chapter \href{/examples}{Examples}}
\end{document}

